<!DOCTYPE html>
{% load static %}
{% load dict_filters %}

<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sárvári Viola</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="{% static 'main/style.css' %}" rel="stylesheet">
</head>

<body>

<!-- NAVBAR – csak akkor, ha NEM az első képernyő -->
{% if level %}
<nav class="navbar navbar-dark mb-0" style="background-color: #001f3f;">
    <div class="container-fluid d-flex justify-content-between align-items-center">
        <a class="navbar-brand text-white text-wrap" style="font-size: 1.1rem; max-width: 80%;">
            Ország- és régiószintű különbségek statisztikai elemzése Szerbiában és a szomszédos országokban
        </a>
        <span class="text-white d-none d-md-block" style="font-size: 1rem;">
            Készítette: Sárvári Viola
        </span>
    </div>
</nav>
{% endif %}


<!-- 1) KEZDŐKÉPERNYŐ – WORD CLOUD + KÁRTYA -->
{% if not level %}
<div class="landing-container">

    <!-- Háttér szófelhő -->
    <div class="keyword-background">
        {% for kw in keyword_list %}
            <span class="kw">{{ kw }}</span>
        {% endfor %}
    </div>

    <h1 class="landing-title">
    Ország- és régiószintű különbségek statisztikai elemzése Szerbiában és a szomszédos országokban
    </h1>

    <p class="landing-subtitle">
        Készítette: Sárvári Viola
    </p>

    <!-- Választókártya -->
    <div class="landing-card shadow">
        <h3 class="text-center mb-3">Válassz elemzési szintet</h3>

        <form method="get">
            <div class="mb-3">
                <input type="radio" id="orszag" name="szint" value="orszag">
                <label for="orszag">Ország szintű elemzés</label>
            </div>
            <div class="mb-3">
                <input type="radio" id="regio" name="szint" value="regio">
                <label for="regio">Régió szintű elemzés</label>
            </div>
            <button class="btn btn-primary w-100 mt-2">Tovább</button>
        </form>
    </div>

</div>
{% endif %}



<!-- 2) MÁSODIK KÉPERNYŐ – SZINT VAN, VÁLTOZÓ MÉG NINCS -->
{% if level and not selected_var %}
<div class="d-flex justify-content-center align-items-center selection-screen">
    <div class="card shadow p-4" style="max-width: 450px; width: 100%;">

        <h3 class="text-center mb-3">
            <div>Elemzési szint:</div>
            <div class="text-primary" style="font-size: 1.8rem; font-weight: 600;">
                {% if level == "orszag" %}Ország{% else %}Régió{% endif %}
            </div>
        </h3>

        <form method="get">
            <input type="hidden" name="szint" value="{{ level }}">

            <label class="mb-2">Válassz változót</label>
            <select name="valtozo" class="form-select mb-3">
                {% for v in variables %}
                    <option value="{{ v }}">{{ DISPLAY_NAMES|get_item:v|default:v }}</option>
                {% endfor %}
            </select>

            <button class="btn btn-success w-100">Elemzés indítása</button>
        </form>

    </div>
</div>
{% endif %}



<!-- 3) TELJES DASHBOARD -->
{% if selected_var %}
<div class="container-fluid">

    <!-- Mobile sidebar toggle button -->
    <button class="btn btn-primary d-md-none mobile-sidebar-toggle" id="sidebarToggle" type="button">
        <span>☰</span> Vezérlőpanel
    </button>

    <div class="row">

        <!-- SIDEBAR -->
        <div class="col-md-3 sidebar" id="sidebar">
            <div class="sidebar-block">
                <h5 class="sidebar-title text-center">Vezérlőpanel</h5>

                <!-- Elemzési szint -->
                <form method="get">
                    <label class="sidebar-label d-block mb-2">Elemzési szint</label>

                    <div class="mb-2">
                        <input type="radio" name="szint" value="orszag" id="side_orszag"
                               {% if level == 'orszag' %}checked{% endif %}>
                        <label for="side_orszag">Ország</label>
                    </div>

                    <div class="mb-2">
                        <input type="radio" name="szint" value="regio" id="side_regio"
                               {% if level == 'regio' %}checked{% endif %}>
                        <label for="side_regio">Régió</label>
                    </div>

                    <button class="btn btn-primary w-100 mt-3">Szűrés</button>
                </form>

                <!-- Változó választó -->
                <form method="get" class="mt-4">
                    <input type="hidden" name="szint" value="{{ level }}">

                    <label class="sidebar-label mt-3">Válassz változót</label>

                    <select name="valtozo" class="sidebar-select">
                        {% for v in variables %}
                            <option value="{{ v }}" {% if selected_var == v %}selected{% endif %}>
                                {{ DISPLAY_NAMES|get_item:v|default:v }}
                            </option>
                        {% endfor %}
                    </select>

                    <button class="btn btn-success w-100 mt-3">Szűrés</button>
                </form>

            </div>
        </div>


        <!-- MAIN CONTENT -->
        <div class="col-md-9 p-4">

            <h2 class="text-white mb-4">
                Eredmények: <span class="text-primary">{{ display_var }}</span>
            </h2>

            <!-- {% if stats.normality %}
                {% if stats.all_normal %}
                    <div class="alert alert-success mb-4">
                        A normalitási feltételek teljesülnek.
                        <strong>Az ANOVA eredményei megbízhatóak.</strong>
                    </div>
                {% else %}
                    <div class="alert alert-danger mb-4">
                        Több ország/régió nem normális eloszlású.
                        <strong>Az ANOVA eredményei bizonytalanok.</strong>
                    </div>
                {% endif %}
            {% endif %} -->
                       <!-- Feltételek összegzése -->
            {% if stats.anova %}

                {% if stats.anova.p_float < 0.05 and stats.all_normal and stats.anova.levene_ok %}
                    <!--Minden feltétel teljesül -->
                    <div class="alert alert-success mb-4">
                        <strong>Az ANOVA szignifikáns különbséget mutatott.</strong><br>
                        A normalitási és szóráshomogenitási feltételek teljesülnek, így az
                        ANOVA eredményei statisztikailag megbízhatóak.
                    </div>

                {% elif stats.anova.p_float < 0.05 %}
                    <!--ANOVA szignifikáns, de feltételek nem teljesülnek -->
                    <div class="alert alert-warning mb-4">
                        <strong>Az ANOVA szignifikáns különbséget mutatott, azonban…</strong><br>
                        Legalább egy előfeltétel (normalitás vagy szóráshomogenitás)
                        nem teljesül, ezért az eredmények
                        <strong>óvatosan értelmezendők</strong>.
                    </div>

                {% else %}
                    <!--ANOVA nem szignifikáns -->
                    <div class="alert alert-danger mb-4">
                        <strong>Az ANOVA nem mutatott ki szignifikáns különbséget.</strong><br>
                        A vizsgált csoportok között statisztikailag igazolható eltérés
                        nem volt kimutatható.
                    </div>

                {% endif %}

            {% endif %}
            

            <!-- Normalitási lista -->
            <div class="card shadow mb-4">
                <div class="card-header bg-dark text-white">Normalitás vizsgálat (Shapiro–Wilk)</div>
                <div class="card-body">
                    {% if stats.normality %}
                        <ul class="list-group">
                            {% for item in stats.normality %}
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <div>
                                        <strong>{{ item.name }}</strong>
                                        <br>
                                        <small>W = {{ item.w }} • p = {{ item.p }}</small>
                                    </div>

                                    {% if item.normal %}
                                        <span class="badge bg-success rounded-pill">Normális</span>
                                    {% else %}
                                        <span class="badge bg-danger rounded-pill">Nem normális</span>
                                    {% endif %}
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p class="text-muted">Ehhez a változóhoz nincs adat.</p>
                    {% endif %}
                </div>
            </div>
{% if stats.anova %}
<div class="row mb-4 align-items-start">

    <!-- BAL OLDAL: ALAP VÁLTOZÓ -->
    <div class="col-md-6">

        <!-- Levene -->
        <div class="card shadow mb-3
            {% if stats.anova.levene_ok %}border-success{% else %}border-danger{% endif %}
        ">
            <div class="card-header bg-dark text-white">
                Levene-próba (szóráshomogenitás)
            </div>
            <div class="card-body">
                <p><strong>F érték:</strong> {{ stats.anova.levene_f }}</p>
                <p><strong>p-érték:</strong> {{ stats.anova.levene_p }}</p>

                {% if stats.anova.levene_ok %}
                    <span class="badge bg-success">Szóráshomogenitás teljesül</span>
                {% else %}
                    <span class="badge bg-danger">Szóráshomogenitás NEM teljesül</span>
                {% endif %}
            </div>
        </div>

        <!-- ANOVA -->
        <div class="stat-card shadow mb-3">
            <h6>{{ display_var }} – ANOVA F-érték</h6>
            <p class="value">{{ stats.anova.anova_f }}</p>
        </div>

        <div class="stat-card shadow
            {% if stats.anova.p_float < 0.05 %}
                stat-border-good
            {% else %}
                stat-border-bad
            {% endif %}
        ">
            <h6>Szignifikancia (p-érték)</h6>
            <p class="value">{{ stats.anova.anova_p }}</p>
        </div>

    </div>

    {% if paired_anova %}
    <!-- JOBB OLDAL: PÁRVÁLTOZÓ -->
    <div class="col-md-6">

        <!-- Levene -->
        <div class="card shadow mb-3
            {% if paired_anova.levene_ok %}border-success{% else %}border-danger{% endif %}
        ">
            <div class="card-header bg-dark text-white">
                {{ paired_display }} – Levene-próba (szóráshomogenitás)
            </div>
            <div class="card-body">
                <p><strong>F érték:</strong> {{ paired_anova.levene_f }}</p>
                <p><strong>p-érték:</strong> {{ paired_anova.levene_p }}</p>

                {% if paired_anova.levene_ok %}
                    <span class="badge bg-success">Szóráshomogenitás teljesül</span>
                {% else %}
                    <span class="badge bg-danger">Szóráshomogenitás NEM teljesül</span>
                {% endif %}
            </div>
        </div>

        <!-- ANOVA -->
        <div class="stat-card shadow mb-3">
            <h6>{{ paired_display }} – ANOVA F-érték</h6>
            <p class="value">{{ paired_anova.anova_f }}</p>
        </div>

        <div class="stat-card shadow
            {% if paired_anova.p_float < 0.05 %}
                stat-border-good
            {% else %}
                stat-border-bad
            {% endif %}
        ">
            <h6>Szignifikancia (p-érték)</h6>
            <p class="value">{{ paired_anova.anova_p }}</p>
        </div>

    </div>
    {% elif image_path %}
    <!-- HA NINCS PÁR, DE VAN KÉP -->
    <div class="col-md-6">
        <div class="card shadow h-100">
            <div class="card-header bg-secondary text-white">
                {{ display_var }} – Eredmények ábrája
            </div>
            <div class="card-body text-center">
                <img src="{% static image_path %}" class="img-fluid rounded shadow">
            </div>
        </div>
    </div>
    {% endif %}

</div>
{% endif %}


            {% if image_path and paired_image_path %}
            <div class="row mb-4">

                <div class="col-md-6">
                    <div class="card shadow">
                        <div class="card-header bg-secondary text-white">
                            {{ display_var }} – Eredmények ábrája
                        </div>
                        <div class="card-body text-center">
                            <img src="{% static image_path %}" class="img-fluid rounded shadow">
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="card shadow">
                        <div class="card-header bg-secondary text-white">
                            {{ paired_display }} – Eredmények ábrája
                        </div>
                        <div class="card-body text-center">
                            <img src="{% static paired_image_path %}" class="img-fluid rounded shadow">
                        </div>
                    </div>
                </div>

            </div>
            {% endif %}

        </div>
    </div>
</div>
{% endif %}



<!-- SCRIPT -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", () => {
    // Háttér kulcsszavak véletlenszerű elhelyezése és méretezése
    // Minden kulcsszót random pozícióba, méretbe és szögbe helyezünk a vizuális hatás érdekében
    const keywords = document.querySelectorAll(".keyword-background .kw");
    keywords.forEach(kw => {
        const x = Math.random() * 100;
        const y = Math.random() * 100;
        const size = Math.random() * 1.6 + 0.8;
        const rot = Math.random() * 30 - 15;

        kw.style.left = x + "%";
        kw.style.top = y + "%";
        kw.style.fontSize = size + "rem";
        kw.style.transform = `rotate(${rot}deg)`;
    });

    // Mobil sidebar megjelenítésének kezelése
    // A hamburger menü gombbal ki/be lehet csúsztatni a sidebar-t mobil nézetben
    const sidebarToggle = document.getElementById("sidebarToggle");
    const sidebar = document.getElementById("sidebar");

    if (sidebarToggle && sidebar) {
        sidebarToggle.addEventListener("click", () => {
            sidebar.classList.toggle("sidebar-visible");
            const isVisible = sidebar.classList.contains("sidebar-visible");
            sidebarToggle.innerHTML = isVisible ? '<span>✕</span> Bezár' : '<span>☰</span> Vezérlőpanel';
        });

        // Ha mobilon a sidebar-on vagy a toggle gombon kívülre kattintunk, bezárjuk a sidebar-t
        // Ez javítja a felhasználói élményt, mivel intuitív módon működik
        document.addEventListener("click", (e) => {
            if (window.innerWidth <= 768) {
                if (!sidebar.contains(e.target) && !sidebarToggle.contains(e.target)) {
                    sidebar.classList.remove("sidebar-visible");
                    sidebarToggle.innerHTML = '<span>☰</span> Vezérlőpanel';
                }
            }
        });
    }
});
</script>

</body>
</html>
